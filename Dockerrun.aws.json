{
    "AWSEBDockerrunVersion": "2",
    "containerDefinitions": [
        {
            "command": [
                "gunicorn",
                "-b",
                "0.0.0.0:5000",
                "-w",
                "3",
                "-t",
                "240",
                "wsgi:app"
            ],
            "environment": [
                {
                    "name": "APP_SETTINGS",
                    "value": "config.ProductionConfig"
                },
                {
                    "name": "SECRET_KEY",
                    "value": "dockertest"
                },
                {
                    "name": "DATABASE_URL",
                    "value": "postgresql://postgres:postgres@postgres:5432/ihome_db"
                }
            ],
            "essential": true,
            "links": [
                "postgres"
            ],
            "mountPoints": [
                {
                    "containerPath": "/apiserver",
                    "sourceVolume": "_BackendApiserver"
                }
            ],
            "name": "backend",
            "portMappings": [
                {
                    "containerPort": 5000,
                    "hostPort": 5000
                }
            ]
        },
        {
            "environment": [
                {
                    "name": "cluster.name",
                    "value": "elasticsearch"
                },
                {
                    "name": "ES_JAVA_OPTS",
                    "value": "-Xms256m -Xmx256m"
                },
                {
                    "name": "XPACK_SECURITY_ENABLED",
                    "value": "false"
                }
            ],
            "essential": true,
            "mountPoints": [
                {
                    "containerPath": "/usr/share/elasticsearch/config/elasticsearch.yml",
                    "sourceVolume": "_BackendElasticsearchConfigElasticsearch_Yml"
                }
            ],
            "name": "elasticsearch",
            "portMappings": [
                {
                    "containerPort": 9200,
                    "hostPort": 9200
                },
                {
                    "containerPort": 9300,
                    "hostPort": 9300
                }
            ]
        },
        {
            "essential": true,
            "mountPoints": [
                {
                    "containerPath": "/frontend",
                    "sourceVolume": "_Frontend"
                },
                {
                    "containerPath": "/frontend/build",
                    "sourceVolume": "Build_Folder"
                },
                {
                    "containerPath": "/frontend/node_modules",
                    "sourceVolume": "_FrontendNode_Modules"
                }
            ],
            "name": "frontend"
        },
        {
            "command": [
                "gunicorn",
                "-b",
                "0.0.0.0:7000",
                "-w",
                "3",
                "-t",
                "240",
                "wsgi:app"
            ],
            "environment": [
                {
                    "name": "APP_SETTINGS",
                    "value": "config.ProductionConfig"
                },
                {
                    "name": "SECRET_KEY",
                    "value": "dockertest"
                },
                {
                    "name": "DATABASE_URL",
                    "value": "postgresql://postgres:postgres@postgres:5432/ihome_db"
                }
            ],
            "essential": true,
            "links": [
                "postgres"
            ],
            "mountPoints": [
                {
                    "containerPath": "/modelserver/",
                    "sourceVolume": "_BackendModelserver"
                }
            ],
            "name": "modelserver",
            "portMappings": [
                {
                    "containerPort": 7000,
                    "hostPort": 7000
                }
            ]
        },
        {
            "essential": true,
            "mountPoints": [
                {
                    "containerPath": "/var/www/frontend",
                    "sourceVolume": "Build_Folder"
                }
            ],
            "name": "nginx",
            "portMappings": [
                {
                    "containerPort": 8080,
                    "hostPort": 8080
                },
                {
                    "containerPort": 8081,
                    "hostPort": 8081
                }
            ]
        },
        {
            "environment": [
                {
                    "name": "POSTGRES_USER",
                    "value": "postgres"
                },
                {
                    "name": "POSTGRES_PASSWORD",
                    "value": "postgres"
                },
                {
                    "name": "POSTGRES_DB",
                    "value": "ihome_db"
                }
            ],
            "essential": true,
            "mountPoints": [
                {
                    "containerPath": "/var/lib/postgresql/data/",
                    "sourceVolume": "Postgres_Data"
                }
            ],
            "name": "postgres",
            "portMappings": [
                {
                    "containerPort": 5432,
                    "hostPort": 5432
                }
            ]
        },
        {
            "environment": [
                {
                    "name": "RABBITMQ_DEFAULT_USER",
                    "value": "rabbitmq"
                },
                {
                    "name": "RABBITMQ_DEFAULT_PASS",
                    "value": "rabbitmq"
                }
            ],
            "essential": true,
            "image": "rabbitmq:3-management",
            "name": "rabbit",
            "portMappings": [
                {
                    "containerPort": 5672,
                    "hostPort": 5672
                },
                {
                    "containerPort": 15672,
                    "hostPort": 15672
                }
            ]
        },
        {
            "command": [
                "celery",
                "-A",
                "tasks.celery",
                "worker",
                "--loglevel=info"
            ],
            "essential": true,
            "name": "worker"
        }
    ],
    "family": "",
    "volumes": [
        {
            "host": {
                "sourcePath": "postgres_data"
            },
            "name": "Postgres_Data"
        },
        {
            "host": {
                "sourcePath": "backend/modelserver/"
            },
            "name": "_BackendModelserver"
        },
        {
            "host": {
                "sourcePath": "backend/apiserver"
            },
            "name": "_BackendApiserver"
        },
        {
            "host": {
                "sourcePath": "frontend/"
            },
            "name": "_Frontend"
        },
        {
            "host": {
                "sourcePath": "build_folder"
            },
            "name": "Build_Folder"
        },
        {
            "host": {
                "sourcePath": "frontend/node_modules/"
            },
            "name": "_FrontendNode_Modules"
        },
        {
            "host": {
                "sourcePath": "backend/elasticsearch/config/elasticsearch.yml"
            },
            "name": "_BackendElasticsearchConfigElasticsearch_Yml"
        }
    ]
}
